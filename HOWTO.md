# Alter Imagineer MVP: 初学者向け手順書

このドキュメントは、現在のプロジェクト構成に基づき、データ収集から学習、推論までの流れをわかりやすくまとめたものです。

## 1. 目的
- 収集アプリで「好みのレタッチ」を作り、画像とパラメータを保存する
- そのデータを使って機械学習モデルを学習する
- 推論アプリで新しい画像に対して自動レタッチを行う

## 2. 事前準備
### 2.1 必要ツール
- Python (uvが使えること)
- uv (Python環境・依存管理ツール)

### 2.2 依存関係のインストール
プロジェクトのルートで実行します。
```
uv sync
```

## 3. データ収集フロー
### 3.1 収集アプリの起動
```
uv run python collector_app/dpg_app.py
```

### 3.2 使い方
1. 「写真を選ぶ(推奨)」から画像を選択します
2. スライダーでレタッチを調整します
3. 「Save sample」を押して保存します

### 3.3 保存先
- 元画像: dataset/before/0001.jpg
- レタッチ画像: dataset/after/0001.jpg
- パラメータ: dataset/params/0001.json
- 一覧: dataset/index.csv

### 3.4 重要ポイント
- 画像は3:2または2:3に自動トリミングされます
- 連番IDは自動で採番されます

## 4. 学習フロー
### 4.1 学習コマンド
```
uv run python trainer/train.py --data dataset --out artifacts
```

### 4.2 出力成果物
- artifacts/model.pt (学習済み重み)
- artifacts/config.json (前処理情報・レンジ)
- artifacts/metrics.json (学習ログ)

### 4.3 よくあるトラブル
- `index.csv` が無い場合は収集アプリでデータを作成してください
- GPUが無くても学習できますが、時間がかかります

## 5. 推論フロー
### 5.1 推論アプリの起動
```
uv run streamlit run infer_app/app.py
```

### 5.2 使い方
1. 画像をアップロードします
2. 「Run Inference」で推論実行
3. Before / AI After / (あればGT After) が表示されます
4. 「Save AI After」で出力保存できます

### 5.3 GT After表示について
- ファイル名が4桁ID (例: 0001.jpg) の場合のみ表示されます
- dataset/after/0001.jpg があれば比較できます

## 6. 使い方まとめ
1. 収集アプリでデータを作る
2. trainer で学習する
3. infer_app で推論する

## 7. 改善案 (今後の拡張)
- データ拡張 (ランダムクロップや色変換)
- 学習時の画像損失 (After画像を直接比較)
- 推論UIでのパラメータ編集と再出力
- 収集アプリのショートカット操作
- 学習・推論の進捗表示やログ保存

## 8. よくある質問
### Q: 画像が保存されません
- dataset/ 以下が作成されているか確認してください
- アプリのエラー表示も確認してください

### Q: 推論で model.pt が見つからない
- 先に trainer を実行して model.pt を作成してください

### Q: 日本語パスが表示されない
- Windowsの日本語フォントを利用する設定があります
- もし表示が崩れる場合は報告してください
